<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BJJ Trader - Se√±ales en Tiempo Real</title>
    <meta name="description" content="Dashboard de trading con se√±ales en tiempo real para Forex" />
    
    <!-- TradingView Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    
    <style>
      /* ===========================================
         CSS VARIABLES & RESET
         =========================================== */
      :root {
        --bg-primary: #0a0e14;
        --bg-secondary: #12171f;
        --bg-tertiary: #1a2130;
        --bg-card: linear-gradient(145deg, #151b24, #1d2433);
        --border-color: rgba(255, 255, 255, 0.06);
        --border-glow: rgba(99, 102, 241, 0.3);
        --text-primary: #ffffff;
        --text-secondary: rgba(255, 255, 255, 0.6);
        --text-muted: rgba(255, 255, 255, 0.4);
        --accent-green: #10b981;
        --accent-green-glow: rgba(16, 185, 129, 0.4);
        --accent-red: #ef4444;
        --accent-red-glow: rgba(239, 68, 68, 0.4);
        --accent-blue: #6366f1;
        --accent-blue-glow: rgba(99, 102, 241, 0.4);
        --accent-purple: #a855f7;
        --accent-yellow: #f59e0b;
        --gradient-primary: linear-gradient(135deg, #6366f1, #a855f7);
        --gradient-green: linear-gradient(135deg, #10b981, #34d399);
        --gradient-red: linear-gradient(135deg, #ef4444, #f87171);
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.4);
        --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.5);
        --shadow-glow: 0 0 40px rgba(99, 102, 241, 0.15);
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 24px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
      }

      /* ===========================================
         GLASSMORPHISM UTILITIES
         =========================================== */
      .glass {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--border-color);
      }

      .glass-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .glass-card:hover {
        border-color: var(--border-glow);
        box-shadow: var(--shadow-glow);
        transform: translateY(-2px);
      }

      /* ===========================================
         HEADER
         =========================================== */
      .header {
        background: rgba(10, 14, 20, 0.8);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border-color);
        padding: 1rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .logo-icon {
        width: 40px;
        height: 40px;
        background: var(--gradient-primary);
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        box-shadow: 0 4px 12px var(--accent-blue-glow);
      }

      .logo-text {
        font-size: 1.25rem;
        font-weight: 700;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        letter-spacing: -0.02em;
      }

      .header-controls {
        display: flex;
        gap: 0.75rem;
        align-items: center;
      }

      .status-pill {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 999px;
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--accent-green);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--accent-green);
        box-shadow: 0 0 8px var(--accent-green);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.6; transform: scale(0.9); }
      }

      .sound-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        color: var(--text-secondary);
        font-size: 0.8rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }

      .sound-btn:hover {
        background: var(--accent-blue);
        border-color: var(--accent-blue);
        color: white;
      }

      .sound-btn.active {
        background: var(--accent-blue);
        border-color: var(--accent-blue);
        color: white;
      }

      /* ===========================================
         MAIN LAYOUT
         =========================================== */
      .main-container {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 1.5rem;
        padding: 1.5rem;
        max-width: 1800px;
        margin: 0 auto;
        min-height: calc(100vh - 80px);
      }

      /* ===========================================
         CHART SECTION
         =========================================== */
      .chart-section {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      /* Symbol Tabs */
      .symbol-tabs-wrapper {
        position: relative;
      }

      .symbol-tabs {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        padding: 0.25rem;
        background: var(--bg-secondary);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-color);
      }

      .symbol-tab {
        padding: 0.6rem 1.2rem;
        background: transparent;
        border: none;
        border-radius: var(--radius-md);
        color: var(--text-secondary);
        cursor: pointer;
        font-weight: 500;
        font-size: 0.85rem;
        transition: all 0.2s;
        font-family: inherit;
      }

      .symbol-tab:hover {
        color: var(--text-primary);
        background: rgba(255, 255, 255, 0.05);
      }

      .symbol-tab.active {
        background: var(--gradient-primary);
        color: white;
        box-shadow: 0 4px 12px var(--accent-blue-glow);
      }

      /* Chart Container */
      .chart-wrapper {
        flex: 1;
        min-height: 450px;
      }

      .chart-container {
        height: 100%;
        border-radius: var(--radius-lg);
        overflow: hidden;
        border: 1px solid var(--border-color);
        background: var(--bg-secondary);
      }

      #main-chart {
        width: 100%;
        height: 100%;
      }

      /* ===========================================
         INDICATORS GRID
         =========================================== */
      .indicators-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
      }

      .indicator-card {
        padding: 1.25rem;
        position: relative;
        overflow: hidden;
      }

      .indicator-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient-primary);
        opacity: 0;
        transition: opacity 0.3s;
      }

      .indicator-card:hover::before {
        opacity: 1;
      }

      .indicator-icon {
        width: 36px;
        height: 36px;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        margin-bottom: 0.75rem;
      }

      .indicator-icon.price { background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(168, 85, 247, 0.2)); }
      .indicator-icon.rsi { background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(251, 191, 36, 0.2)); }
      .indicator-icon.macd { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(52, 211, 153, 0.2)); }
      .indicator-icon.trend { background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(248, 113, 113, 0.2)); }

      .indicator-label {
        font-size: 0.7rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .indicator-value {
        font-size: 1.5rem;
        font-weight: 700;
        letter-spacing: -0.02em;
        line-height: 1.2;
      }

      .indicator-value.bullish { color: var(--accent-green); }
      .indicator-value.bearish { color: var(--accent-red); }
      .indicator-value.neutral { color: var(--text-primary); }

      .indicator-subtitle {
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
      }

      /* ===========================================
         ALERTS SIDEBAR
         =========================================== */
      .alerts-sidebar {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        max-height: calc(100vh - 110px);
        position: sticky;
        top: 90px;
      }

      .sidebar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
      }

      .sidebar-title {
        font-size: 1rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .alert-count {
        background: var(--gradient-primary);
        color: white;
        font-size: 0.7rem;
        font-weight: 700;
        padding: 0.25rem 0.6rem;
        border-radius: 999px;
        min-width: 24px;
        text-align: center;
      }

      .alerts-list {
        flex: 1;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        padding-right: 0.5rem;
      }

      .alerts-list::-webkit-scrollbar {
        width: 4px;
      }

      .alerts-list::-webkit-scrollbar-track {
        background: transparent;
      }

      .alerts-list::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
      }

      /* Alert Card */
      .alert-card {
        padding: 1rem;
        animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        position: relative;
        overflow: hidden;
      }

      .alert-card::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
      }

      .alert-card.buy::before { background: var(--gradient-green); }
      .alert-card.sell::before { background: var(--gradient-red); }

      @keyframes slideIn {
        from { opacity: 0; transform: translateX(20px); }
        to { opacity: 1; transform: translateX(0); }
      }

      .alert-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.75rem;
      }

      .alert-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.3rem 0.6rem;
        border-radius: var(--radius-sm);
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .alert-badge.buy {
        background: rgba(16, 185, 129, 0.15);
        color: var(--accent-green);
      }

      .alert-badge.sell {
        background: rgba(239, 68, 68, 0.15);
        color: var(--accent-red);
      }

      .alert-symbol {
        font-size: 1rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
      }

      .alert-time {
        font-size: 0.7rem;
        color: var(--text-muted);
      }

      .alert-reason {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-bottom: 0.75rem;
        line-height: 1.4;
      }

      .alert-levels {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
      }

      .level-item {
        text-align: center;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.02);
        border-radius: var(--radius-sm);
        border: 1px solid var(--border-color);
      }

      .level-label {
        font-size: 0.65rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 0.2rem;
      }

      .level-value {
        font-size: 0.8rem;
        font-weight: 600;
        font-family: "SF Mono", "Fira Code", monospace;
      }

      .level-value.price { color: var(--accent-blue); }
      .level-value.sl { color: var(--accent-red); }
      .level-value.tp { color: var(--accent-green); }

      /* Empty State */
      .empty-alerts {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--text-secondary);
      }

      .empty-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      .empty-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .empty-text {
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      /* ===========================================
         NOTIFICATION POPUP
         =========================================== */
      .notification-popup {
        position: fixed;
        top: 100px;
        right: 20px;
        max-width: 380px;
        padding: 1.5rem;
        border-radius: var(--radius-lg);
        z-index: 1000;
        animation: popIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        box-shadow: var(--shadow-lg);
      }

      .notification-popup.buy {
        background: linear-gradient(145deg, #12271d, #0d3320);
        border: 1px solid rgba(16, 185, 129, 0.3);
      }

      .notification-popup.sell {
        background: linear-gradient(145deg, #271216, #330d12);
        border: 1px solid rgba(239, 68, 68, 0.3);
      }

      @keyframes popIn {
        from { opacity: 0; transform: translateX(100%) scale(0.9); }
        to { opacity: 1; transform: translateX(0) scale(1); }
      }

      .notification-close {
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 1.25rem;
        transition: color 0.2s;
      }

      .notification-close:hover {
        color: var(--text-primary);
      }

      .notification-title {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .notification-title.buy { color: var(--accent-green); }
      .notification-title.sell { color: var(--accent-red); }

      /* ===========================================
         RESPONSIVE DESIGN - MOBILE FIRST
         =========================================== */
      
      /* Tablet and below */
      @media (max-width: 1200px) {
        .main-container {
          grid-template-columns: 1fr;
          max-width: 100%;
        }

        .alerts-sidebar {
          position: static;
          max-height: 400px;
          order: -1;
        }

        .indicators-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      /* Mobile landscape and small tablets */
      @media (max-width: 768px) {
        .header {
          padding: 0.75rem 1rem;
          flex-direction: column;
          gap: 0.75rem;
          align-items: stretch;
        }

        .logo {
          justify-content: center;
        }

        .header-controls {
          display: flex;
          justify-content: center;
          gap: 0.75rem;
        }

        .main-container {
          padding: 0.75rem;
          gap: 0.75rem;
        }

        /* Symbol tabs with scroll indicator */
        .symbol-tabs-wrapper {
          position: relative;
          overflow: hidden;
        }

        .symbol-tabs-wrapper::after {
          content: "";
          position: absolute;
          right: 0;
          top: 0;
          bottom: 0;
          width: 40px;
          background: linear-gradient(to left, var(--bg-secondary) 20%, transparent);
          pointer-events: none;
        }

        .symbol-tabs {
          overflow-x: auto;
          flex-wrap: nowrap;
          -webkit-overflow-scrolling: touch;
          scrollbar-width: none;
          padding: 0.5rem;
          padding-right: 50px;
        }

        .symbol-tabs::-webkit-scrollbar {
          display: none;
        }

        .symbol-tab {
          flex-shrink: 0;
          padding: 0.6rem 1rem;
          font-size: 0.85rem;
        }

        .chart-wrapper {
          min-height: 300px;
          max-height: 350px;
        }

        .indicators-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 0.5rem;
        }

        .indicator-card {
          padding: 0.75rem;
        }

        .indicator-icon {
          width: 28px;
          height: 28px;
          font-size: 0.85rem;
          margin-bottom: 0.5rem;
        }

        .indicator-label {
          font-size: 0.6rem;
        }

        .indicator-value {
          font-size: 1.1rem;
        }

        .indicator-subtitle {
          font-size: 0.65rem;
        }

        .alerts-sidebar {
          max-height: none;
          order: 1;
        }

        .alerts-list {
          max-height: 300px;
        }

        .telegram-cta {
          padding: 0.75rem 1rem;
        }

        .telegram-icon {
          width: 36px;
          height: 36px;
        }

        .telegram-title {
          font-size: 0.85rem;
        }
      }

      /* Mobile portrait */
      @media (max-width: 480px) {
        .header {
          padding: 0.6rem 0.75rem;
          gap: 0.5rem;
        }

        .logo-icon {
          width: 32px;
          height: 32px;
          font-size: 1rem;
        }

        .logo-text {
          font-size: 1rem;
        }

        .header-controls {
          width: 100%;
          justify-content: space-between;
        }

        .sound-btn, .status-pill {
          padding: 0.4rem 0.75rem;
          font-size: 0.75rem;
        }

        .main-container {
          padding: 0.5rem;
          gap: 0.5rem;
        }

        .symbol-tab {
          padding: 0.5rem 0.75rem;
          font-size: 0.75rem;
        }

        .chart-wrapper {
          min-height: 250px;
          max-height: 300px;
        }

        .indicators-grid {
          grid-template-columns: 1fr 1fr;
          gap: 0.4rem;
        }

        .indicator-card {
          padding: 0.6rem;
        }

        .indicator-icon {
          width: 24px;
          height: 24px;
          font-size: 0.75rem;
          margin-bottom: 0.4rem;
        }

        .indicator-value {
          font-size: 1rem;
        }

        .indicator-subtitle {
          display: none;
        }

        .alert-card {
          padding: 0.75rem;
        }

        .alert-symbol {
          font-size: 0.9rem;
        }

        .alert-reason {
          font-size: 0.75rem;
        }

        .alert-levels {
          gap: 0.3rem;
        }

        .level-item {
          padding: 0.35rem;
        }

        .level-label {
          font-size: 0.55rem;
        }

        .level-value {
          font-size: 0.7rem;
        }

        .notification-popup {
          left: 8px;
          right: 8px;
          top: 70px;
          max-width: none;
          padding: 1rem;
        }

        .empty-icon {
          font-size: 2rem;
        }

        .empty-title {
          font-size: 0.9rem;
        }

        .empty-text {
          font-size: 0.75rem;
        }
      }

      /* Extra small devices */
      @media (max-width: 360px) {
        .indicator-icon {
          display: none;
        }

        .indicator-card {
          padding: 0.5rem;
        }

        .indicator-value {
          font-size: 0.9rem;
        }

        .logo-text {
          font-size: 0.9rem;
        }

        .chart-wrapper {
          min-height: 220px;
        }
      }

      /* ===========================================
         TELEGRAM CTA
         =========================================== */
      .telegram-cta {
        background: linear-gradient(135deg, rgba(0, 136, 204, 0.1), rgba(0, 136, 204, 0.05));
        border: 1px solid rgba(0, 136, 204, 0.2);
        border-radius: var(--radius-lg);
        padding: 1rem 1.25rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        text-decoration: none;
        color: var(--text-primary);
        transition: all 0.3s;
      }

      .telegram-cta:hover {
        background: linear-gradient(135deg, rgba(0, 136, 204, 0.2), rgba(0, 136, 204, 0.1));
        border-color: rgba(0, 136, 204, 0.4);
        transform: translateY(-2px);
      }

      .telegram-icon {
        width: 40px;
        height: 40px;
        background: #0088cc;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        flex-shrink: 0;
      }

      .telegram-content {
        flex: 1;
      }

      .telegram-title {
        font-weight: 600;
        font-size: 0.9rem;
        margin-bottom: 0.15rem;
      }

      .telegram-subtitle {
        font-size: 0.75rem;
        color: var(--text-secondary);
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <div class="logo-icon">üìà</div>
        <span class="logo-text">BJJ Trader</span>
      </div>
      <div class="header-controls">
        <button class="sound-btn active" id="soundToggle" onclick="toggleSound()">
          <span id="soundIcon">üîî</span>
          <span id="soundText">Sonido</span>
        </button>
        <div class="status-pill">
          <div class="status-dot"></div>
          <span id="connectionStatus">En vivo</span>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
      <!-- Chart Section -->
      <section class="chart-section">
        <!-- Symbol Tabs -->
        <div class="symbol-tabs-wrapper">
          <div class="symbol-tabs" id="symbolTabs"></div>
        </div>

        <!-- Chart -->
        <div class="chart-wrapper">
          <div class="chart-container">
            <div id="main-chart"></div>
          </div>
        </div>

        <!-- Indicators -->
        <div class="indicators-grid">
          <div class="glass-card indicator-card">
            <div class="indicator-icon price">üí∞</div>
            <div class="indicator-label">Precio</div>
            <div class="indicator-value neutral" id="ind-price">-.-----</div>
            <div class="indicator-subtitle" id="ind-change">-</div>
          </div>
          <div class="glass-card indicator-card">
            <div class="indicator-icon rsi">üìä</div>
            <div class="indicator-label">RSI (14)</div>
            <div class="indicator-value neutral" id="ind-rsi">-</div>
            <div class="indicator-subtitle" id="ind-rsi-status">Calculando...</div>
          </div>
          <div class="glass-card indicator-card">
            <div class="indicator-icon macd">üìà</div>
            <div class="indicator-label">MACD</div>
            <div class="indicator-value neutral" id="ind-macd">-</div>
            <div class="indicator-subtitle" id="ind-macd-status">Calculando...</div>
          </div>
          <div class="glass-card indicator-card">
            <div class="indicator-icon trend">üéØ</div>
            <div class="indicator-label">Tendencia</div>
            <div class="indicator-value neutral" id="ind-trend">-</div>
            <div class="indicator-subtitle" id="ind-atr">ATR: -</div>
          </div>
        </div>
      </section>

      <!-- Alerts Sidebar -->
      <aside class="alerts-sidebar">
        <!-- Telegram CTA -->
        <a href="https://t.me/BJJTraderAlertas" target="_blank" class="telegram-cta">
          <div class="telegram-icon">‚úàÔ∏è</div>
          <div class="telegram-content">
            <div class="telegram-title">√önete al Canal</div>
            <div class="telegram-subtitle">Recibe alertas en Telegram</div>
          </div>
        </a>

        <div class="sidebar-header">
          <h2 class="sidebar-title">
            üö® Alertas
            <span class="alert-count" id="alertCount">0</span>
          </h2>
        </div>

        <div class="alerts-list" id="alertsList">
          <div class="empty-alerts">
            <div class="empty-icon">üì°</div>
            <p class="empty-title">Esperando se√±ales...</p>
            <p class="empty-text">El bot est√° analizando los mercados en tiempo real</p>
          </div>
        </div>
      </aside>
    </main>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Audio -->
    <audio id="alertSound" preload="auto">
      <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleW1RYHGQa2NiWmJra2hVb4N7f4aWoqaieqdofmNUWW93bGhnZ3N1aV5nb4aBfIF/gYqJkI2GfWdaUFeHlZSLfHZ3dGpnb3V0eIF6bmpoeXd4gYmQlJOahXVkYmN6i5iYmZGOkZ6koaSak4V0amJfZ3R3c25qbHBwdHh3dnt4c3N3gIiFhoWBenVydnh1bXB1d3l9e3l/g4F8eHl8gn15cXFyc3R3fXx5enl2cnF1fIKEhYmKg3t4dXZ5f4B+d3d3eHl4dnV4en19e3h4en+DhISEgXt3dXZ6fX18eXh4eHd4eXp7e3t5eHl7fX5/gH99enh4eXt7e3t6eXh4eHl5eXp6enp6enp7fH19fX59fHt7e3t7e3t7e3t7e3t7e3t7fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8" type="audio/wav" />
    </audio>

    <script>
      // ===========================================
      // STATE & CONFIG
      // ===========================================
      let socket;
      let chart;
      let candlestickSeries;
      let ema12Series;
      let ema26Series;
      let currentSymbol = "EURUSD=X";
      let soundEnabled = true;
      let alerts = [];

      const symbols = [
        "EURUSD=X", "GBPUSD=X", "USDJPY=X", "USDCHF=X",
        "AUDUSD=X", "USDCAD=X", "NZDUSD=X",
        "EURGBP=X", "EURJPY=X", "GBPJPY=X", "AUDJPY=X",
        "EURAUD=X", "EURCHF=X", "GBPCHF=X"
      ];

      // ===========================================
      // INITIALIZATION
      // ===========================================
      document.addEventListener("DOMContentLoaded", () => {
        initChart();
        initSymbolTabs();
        initSocket();
      });

      // ===========================================
      // CHART
      // ===========================================
      function initChart() {
        const container = document.getElementById("main-chart");

        chart = LightweightCharts.createChart(container, {
          width: container.clientWidth,
          height: container.clientHeight,
          layout: {
            background: { type: "solid", color: "#12171f" },
            textColor: "rgba(255, 255, 255, 0.5)",
          },
          grid: {
            vertLines: { color: "rgba(255, 255, 255, 0.03)" },
            horzLines: { color: "rgba(255, 255, 255, 0.03)" },
          },
          crosshair: {
            mode: LightweightCharts.CrosshairMode.Normal,
            vertLine: { color: "rgba(99, 102, 241, 0.3)", width: 1, style: 2 },
            horzLine: { color: "rgba(99, 102, 241, 0.3)", width: 1, style: 2 },
          },
          rightPriceScale: { borderColor: "rgba(255, 255, 255, 0.1)" },
          timeScale: { borderColor: "rgba(255, 255, 255, 0.1)", timeVisible: true },
        });

        candlestickSeries = chart.addCandlestickSeries({
          upColor: "#10b981",
          downColor: "#ef4444",
          borderUpColor: "#10b981",
          borderDownColor: "#ef4444",
          wickUpColor: "#10b981",
          wickDownColor: "#ef4444",
        });

        ema12Series = chart.addLineSeries({
          color: "#6366f1",
          lineWidth: 2,
          title: "EMA 12",
        });

        ema26Series = chart.addLineSeries({
          color: "#a855f7",
          lineWidth: 2,
          title: "EMA 26",
        });

        window.addEventListener("resize", () => {
          chart.resize(container.clientWidth, container.clientHeight);
        });
      }

      // ===========================================
      // SYMBOL TABS
      // ===========================================
      function initSymbolTabs() {
        const tabsContainer = document.getElementById("symbolTabs");

        symbols.forEach((symbol) => {
          const tab = document.createElement("button");
          tab.className = `symbol-tab ${symbol === currentSymbol ? "active" : ""}`;
          tab.textContent = symbol.replace("=X", "");
          tab.onclick = () => selectSymbol(symbol);
          tabsContainer.appendChild(tab);
        });
      }

      function selectSymbol(symbol) {
        currentSymbol = symbol;

        document.querySelectorAll(".symbol-tab").forEach((tab) => {
          tab.classList.toggle("active", tab.textContent === symbol.replace("=X", ""));
        });

        if (socket && socket.connected) {
          socket.emit("request_data", { symbol: symbol });
        }
      }

      // ===========================================
      // WEBSOCKET
      // ===========================================
      function initSocket() {
        socket = io();

        socket.on("connect", () => {
          updateConnectionStatus(true);
          socket.emit("request_data", { symbol: currentSymbol });
        });

        socket.on("disconnect", () => updateConnectionStatus(false));
        socket.on("chart_data", updateChart);
        socket.on("indicators", updateIndicators);
        socket.on("new_alert", handleNewAlert);
        socket.on("price_update", updatePrice);
      }

      function updateConnectionStatus(connected) {
        const statusEl = document.getElementById("connectionStatus");
        const dotEl = document.querySelector(".status-dot");
        const pillEl = document.querySelector(".status-pill");

        if (connected) {
          statusEl.textContent = "En vivo";
          dotEl.style.background = "#10b981";
          dotEl.style.boxShadow = "0 0 8px #10b981";
          pillEl.style.borderColor = "rgba(16, 185, 129, 0.2)";
          pillEl.style.background = "rgba(16, 185, 129, 0.1)";
          pillEl.style.color = "#10b981";
        } else {
          statusEl.textContent = "Desconectado";
          dotEl.style.background = "#ef4444";
          dotEl.style.boxShadow = "0 0 8px #ef4444";
          pillEl.style.borderColor = "rgba(239, 68, 68, 0.2)";
          pillEl.style.background = "rgba(239, 68, 68, 0.1)";
          pillEl.style.color = "#ef4444";
        }
      }

      // ===========================================
      // UPDATE CHART
      // ===========================================
      function updateChart(data) {
        if (!data || !data.candles) return;

        const candles = data.candles.map((c) => ({
          time: c.time,
          open: c.open,
          high: c.high,
          low: c.low,
          close: c.close,
        }));

        const ema12Data = data.ema12
          .map((v, i) => ({ time: data.candles[i].time, value: v }))
          .filter((d) => d.value !== null);

        const ema26Data = data.ema26
          .map((v, i) => ({ time: data.candles[i].time, value: v }))
          .filter((d) => d.value !== null);

        candlestickSeries.setData(candles);
        ema12Series.setData(ema12Data);
        ema26Series.setData(ema26Data);
        chart.timeScale().fitContent();
      }

      // ===========================================
      // UPDATE INDICATORS
      // ===========================================
      function updateIndicators(data) {
        const priceEl = document.getElementById("ind-price");
        priceEl.textContent = data.price.toFixed(5);
        priceEl.className = "indicator-value " + (data.change >= 0 ? "bullish" : "bearish");

        document.getElementById("ind-change").textContent = `${data.change >= 0 ? "+" : ""}${data.change.toFixed(4)} (${data.changePercent.toFixed(2)}%)`;

        const rsiEl = document.getElementById("ind-rsi");
        rsiEl.textContent = data.rsi.toFixed(2);

        let rsiClass = "neutral";
        let rsiStatus = "Neutral";
        if (data.rsi < 30) { rsiClass = "bullish"; rsiStatus = "üîµ Sobreventa"; }
        else if (data.rsi > 70) { rsiClass = "bearish"; rsiStatus = "üî¥ Sobrecompra"; }
        rsiEl.className = "indicator-value " + rsiClass;
        document.getElementById("ind-rsi-status").textContent = rsiStatus;

        const macdEl = document.getElementById("ind-macd");
        macdEl.textContent = data.macd.toFixed(6);
        macdEl.className = "indicator-value " + (data.macd > data.macdSignal ? "bullish" : "bearish");
        document.getElementById("ind-macd-status").textContent = data.macd > data.macdSignal ? "üìà Alcista" : "üìâ Bajista";

        const trendEl = document.getElementById("ind-trend");
        const isBullish = data.ema12 > data.ema26;
        trendEl.textContent = isBullish ? "‚ÜóÔ∏è ALCISTA" : "‚ÜòÔ∏è BAJISTA";
        trendEl.className = "indicator-value " + (isBullish ? "bullish" : "bearish");
        document.getElementById("ind-atr").textContent = `ATR: ${data.atr.toFixed(5)}`;
      }

      function updatePrice(data) {
        if (data.symbol !== currentSymbol) return;
        document.getElementById("ind-price").textContent = data.price.toFixed(5);
      }

      // ===========================================
      // HANDLE ALERTS
      // ===========================================
      function handleNewAlert(alert) {
        alerts.unshift(alert);
        if (alerts.length > 50) alerts.pop();

        updateAlertsList();
        showNotification(alert);

        if (soundEnabled) {
          document.getElementById("alertSound").play().catch(() => {});
        }
      }

      function updateAlertsList() {
        const listEl = document.getElementById("alertsList");
        const countEl = document.getElementById("alertCount");

        countEl.textContent = alerts.length;

        if (alerts.length === 0) {
          listEl.innerHTML = `
            <div class="empty-alerts">
              <div class="empty-icon">üì°</div>
              <p class="empty-title">Esperando se√±ales...</p>
              <p class="empty-text">El bot est√° analizando los mercados en tiempo real</p>
            </div>
          `;
          return;
        }

        listEl.innerHTML = alerts.map((a) => `
          <div class="glass-card alert-card ${a.type === 'COMPRA' ? 'buy' : 'sell'}">
            <div class="alert-header">
              <div>
                <span class="alert-badge ${a.type === 'COMPRA' ? 'buy' : 'sell'}">
                  ${a.type === 'COMPRA' ? 'üü¢ COMPRA' : 'üî¥ VENTA'}
                </span>
                <div class="alert-symbol">${a.symbol.replace('=X', '')}</div>
              </div>
              <span class="alert-time">${a.time}</span>
            </div>
            <div class="alert-reason">${a.reason}</div>
            <div class="alert-levels">
              <div class="level-item">
                <div class="level-label">Entrada</div>
                <div class="level-value price">${a.price.toFixed(5)}</div>
              </div>
              <div class="level-item">
                <div class="level-label">Stop Loss</div>
                <div class="level-value sl">${a.stopLoss.toFixed(5)}</div>
              </div>
              <div class="level-item">
                <div class="level-label">Take Profit</div>
                <div class="level-value tp">${a.takeProfit.toFixed(5)}</div>
              </div>
            </div>
          </div>
        `).join("");
      }

      function showNotification(alert) {
        const container = document.getElementById("notificationContainer");
        const id = "notif-" + Date.now();

        const notifHtml = `
          <div id="${id}" class="notification-popup glass ${alert.type === 'COMPRA' ? 'buy' : 'sell'}">
            <button class="notification-close" onclick="closeNotification('${id}')">&times;</button>
            <div class="notification-title ${alert.type === 'COMPRA' ? 'buy' : 'sell'}">
              ${alert.type === 'COMPRA' ? 'üü¢ SE√ëAL DE COMPRA' : 'üî¥ SE√ëAL DE VENTA'}
            </div>
            <div class="alert-symbol" style="margin-bottom: 0.5rem">${alert.symbol.replace('=X', '')}</div>
            <div class="alert-reason">${alert.reason}</div>
            <div class="alert-levels" style="margin-top: 0.75rem">
              <div class="level-item">
                <div class="level-label">Entrada</div>
                <div class="level-value price">${alert.price.toFixed(5)}</div>
              </div>
              <div class="level-item">
                <div class="level-label">SL</div>
                <div class="level-value sl">${alert.stopLoss.toFixed(5)}</div>
              </div>
              <div class="level-item">
                <div class="level-label">TP</div>
                <div class="level-value tp">${alert.takeProfit.toFixed(5)}</div>
              </div>
            </div>
          </div>
        `;

        container.innerHTML = notifHtml;
        setTimeout(() => closeNotification(id), 8000);
      }

      function closeNotification(id) {
        const el = document.getElementById(id);
        if (el) el.remove();
      }

      // ===========================================
      // SOUND TOGGLE
      // ===========================================
      function toggleSound() {
        soundEnabled = !soundEnabled;
        const btn = document.getElementById("soundToggle");
        const icon = document.getElementById("soundIcon");
        const text = document.getElementById("soundText");

        if (soundEnabled) {
          btn.classList.add("active");
          icon.textContent = "üîî";
          text.textContent = "Sonido";
        } else {
          btn.classList.remove("active");
          icon.textContent = "üîï";
          text.textContent = "Mute";
        }
      }
    </script>
  </body>
</html>
